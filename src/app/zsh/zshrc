# https://wiki.archlinuxcn.org/wiki/Zsh

# 配置自动不全
autoload -U compinit promptinit
compinit
promptinit

# 设置 walters 主题的默认命令行提示符
#prompt walters

# 方向键控制的自动补全
zstyle ':completion:*' menu select
# 命令行别名的自动补全
setopt completealiases
# 消除历史记录中的重复条目
setopt HIST_IGNORE_DUPS

# 刷新自动补全
zstyle ':completion:*' rehash true

# zkbd
# run /usr/share/zsh/functions/Misc/zkbd to generate
source "$HOME/.zkbd/$TERM-${${DISPLAY:t}:-$VENDOR-$OSTYPE}"
# setup key accordingly
[[ -n "${key[Home]}"      ]] && bindkey -- "${key[Home]}"       beginning-of-line
[[ -n "${key[End]}"       ]] && bindkey -- "${key[End]}"        end-of-line
[[ -n "${key[Insert]}"    ]] && bindkey -- "${key[Insert]}"     overwrite-mode
[[ -n "${key[Backspace]}" ]] && bindkey -- "${key[Backspace]}"  backward-delete-char
[[ -n "${key[Delete]}"    ]] && bindkey -- "${key[Delete]}"     delete-char
[[ -n "${key[Up]}"        ]] && bindkey -- "${key[Up]}"         up-line-or-history
[[ -n "${key[Down]}"      ]] && bindkey -- "${key[Down]}"       down-line-or-history
[[ -n "${key[Left]}"      ]] && bindkey -- "${key[Left]}"       backward-char
[[ -n "${key[Right]}"     ]] && bindkey -- "${key[Right]}"      forward-char
[[ -n "${key[PageUp]}"    ]] && bindkey -- "${key[PageUp]}"     beginning-of-buffer-or-history
[[ -n "${key[PageDown]}"  ]] && bindkey -- "${key[PageDown]}"   end-of-buffer-or-history
[[ -n "${key[Shift-Tab]}" ]] && bindkey -- "${key[Shift-Tab]}"  reverse-menu-complete


# 快捷键的设置
# https://wiki.zshell.dev/zh-Hans/docs/guides/syntax/bindkey
# https://zsh.sourceforge.io/Doc/Release/Zsh-Line-Editor.html
# Alt-j
bindkey "^[j" backward-char
# Alt-l
bindkey "^[l" forward-char
# Alt-i
bindkey "^[i" up-line-or-history
# Alt-k
bindkey "^[k" down-line-or-history
# Alt-;
bindkey "^[;" end-of-line
# Alt-h
bindkey "^[h" beginning-of-line

# 去掉默认的LESS=-R
unset LESS

# https://unix.stackexchange.com/questions/557486/allowing-comments-in-interactive-zsh-commands
# 允许在交互模式中使用注释
# `echo "abc" # 这是注释` 将输出 abc
# 否则会报错
setopt INTERACTIVE_COMMENTS

# alias 配置
alias ll='ls -l -h --group-directories-first --color=auto'
alias rm="rm -i"
alias mv="mv -i"

# fzf 配置
# Set up fzf key bindings and fuzzy completion
eval "$(fzf --zsh)"

# pkgfile 配置，command-not-found 的支持
source /usr/share/doc/pkgfile/command-not-found.zsh

# zsh-autosuggestions 配置
source /usr/share/zsh/plugins/zsh-autosuggestions/zsh-autosuggestions.zsh

# pywal 的配置 
if [ -e "$HOME/.cache/wal/sequences" ];then
    (cat "$HOME/.cache/wal/sequences" &)
fi
if [ -e "$HOME/.cache/wal/colors-tty.sh" ];then
    source "$HOME/.cache/wal/colors-tty.sh"
fi

# zsh-syntax-highlighting 配置
# NOTE: 这个必须是最后一行，https://github.com/zsh-users/zsh-syntax-highlighting?tab=readme-ov-file#why-must-zsh-syntax-highlightingzsh-be-sourced-at-the-end-of-the-zshrc-file
source /usr/share/zsh/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
